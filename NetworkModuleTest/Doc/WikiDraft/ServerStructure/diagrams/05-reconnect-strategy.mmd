%%{init: {'theme':'base', 'themeVariables': {
'fontFamily':'Segoe UI, Noto Sans KR, sans-serif',
'primaryTextColor':'#0F172A',
'lineColor':'#64748B'
}}}%%
flowchart TD
    A[DB connection lost] --> B{server still running}
    B -- No --> Z[stop reconnect loop]
    B -- Yes --> C[start DBReconnectLoop]
    C --> D[wait delay via CV]
    D --> E[ConnectToDBServer]
    E --> F{connected}
    F -- Yes --> G[reconnect complete]
    F -- No --> H{error is WSAECONNREFUSED}
    H -- Yes --> I[delay = 1000ms fixed]
    H -- No --> J[delay = min delay*2 and 30000ms]
    I --> D
    J --> D

    classDef action fill:#E0F2FE,stroke:#0284C7,color:#0C4A6E,stroke-width:1.2px;
    classDef decision fill:#EEF2FF,stroke:#4F46E5,color:#1E1B4B,stroke-width:1.2px;
    classDef backoff fill:#FFF7ED,stroke:#C2410C,color:#7C2D12,stroke-width:1.2px;
    classDef endNode fill:#ECFDF5,stroke:#059669,color:#064E3B,stroke-width:1.2px;

    class A,C,D,E action;
    class B,F,H decision;
    class I,J backoff;
    class Z,G endNode;
