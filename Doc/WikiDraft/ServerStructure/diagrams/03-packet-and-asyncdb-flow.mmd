%%{init: {'theme':'base', 'themeVariables': {
'fontFamily':'Segoe UI, Noto Sans KR, sans-serif',
'primaryTextColor':'#0F172A',
'lineColor':'#64748B',
'signalColor':'#334155'
}}}%%
sequenceDiagram
    autonumber
    participant C as TestClient
    participant TS as TestServer
    participant CS as ClientSession
    participant Q as DBTaskQueue
    participant DB as Local DB
    participant DBS as TestDBServer

    C->>TS: TCP connect + SessionConnectReq
    Note over TS,CS: session created by factory
    TS->>CS: OnConnected()
    CS->>Q: enqueue RecordConnectTime
    Q-->>CS: return immediately
    TS-->>C: SessionConnectRes(sessionId)

    loop every 5s
        C->>TS: PingReq
        TS-->>C: PongRes
    end

    par async DB worker
        Q->>DB: INSERT / UPDATE
        DB-->>Q: result
    and server-to-server
        TS->>DBS: ServerPingReq or DBSavePingTimeReq
        DBS-->>TS: ServerPongRes or DBSavePingTimeRes
    end
