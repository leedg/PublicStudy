%%{init: {'theme':'base', 'themeVariables': {
'fontFamily':'Segoe UI, Noto Sans KR, sans-serif',
'primaryColor':'#EAF4FF',
'primaryTextColor':'#0F172A',
'primaryBorderColor':'#3B82F6',
'lineColor':'#64748B',
'secondaryColor':'#FFF8E6',
'tertiaryColor':'#F8FAFC'
}}}%%
flowchart LR
    Client[TestClient]
    DBServer[TestDBServer Optional]

    subgraph TS[TestServer]
        Engine[Client Engine<br/>auto backend]
        SessionMgr[SessionManager]
        ClientSess[ClientSession]
        DBSess[DBServerSession]
        DBQueue[DBTaskQueue<br/>worker=1]
        LocalDB[Local DB<br/>Mock or SQLite]
        DBSocket[DB socket +<br/>recv/ping threads]
    end

    subgraph SE[ServerEngine]
        Core[Network Core]
        Provider[AsyncIOProvider]
        DBModule[Database Module]
    end

    Client <-->|TCP Packet| Engine
    Engine --> SessionMgr --> ClientSess
    ClientSess -->|enqueue| DBQueue --> LocalDB

    DBSess <-->|server packet| DBSocket <-->|TCP| DBServer

    Engine -.-> Core
    Engine -.-> Provider
    DBQueue -.-> DBModule

    classDef external fill:#EEF2FF,stroke:#4F46E5,color:#1E1B4B,stroke-width:1.2px;
    classDef component fill:#E0F2FE,stroke:#0284C7,color:#0C4A6E,stroke-width:1.2px;
    classDef db fill:#ECFDF5,stroke:#059669,color:#064E3B,stroke-width:1.2px;
    classDef infra fill:#FFF7ED,stroke:#C2410C,color:#7C2D12,stroke-width:1.2px;

    class Client,DBServer external;
    class Engine,SessionMgr,ClientSess,DBSess,DBQueue component;
    class LocalDB,DBModule db;
    class Core,Provider,DBSocket infra;
